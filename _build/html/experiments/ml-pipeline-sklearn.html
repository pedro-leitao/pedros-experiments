
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>A Wine Quality Prediction Experiment with SKLearn Pipelines &#8212; Pedro&#39;s experiments</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'experiments/ml-pipeline-sklearn';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sentiment Classification of Financial Texts using Neural Networks" href="sentiment-partI.html" />
    <link rel="prev" title="Instance vs Model Learning" href="instance_vs_model_learning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Pedro's experiments - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Pedro's experiments - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Pedro’s experiments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">How to's</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../howtos/apple-silicon-ml.html">Setting up a Machine Learning environment on Apple Silicon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos/distributed-training.html">Distributed training with Keras &amp; Tensorflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Experiments</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="instance_vs_model_learning.html">Instance vs Model Learning</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">A Wine Quality Prediction Experiment with SKLearn Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment-partI.html">Sentiment Classification of Financial Texts using Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="shakespeare-embeddings.html">An Exploration of Language Prediction: A Simplified Model for Shakespearean Text Generation</a></li>

<li class="toctree-l1"><a class="reference internal" href="gensim.html">Basics of word vectors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/experiments/ml-pipeline-sklearn.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>A Wine Quality Prediction Experiment with SKLearn Pipelines</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-different-models">Evaluating different models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-remarks">Final remarks</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="a-wine-quality-prediction-experiment-with-sklearn-pipelines">
<h1>A Wine Quality Prediction Experiment with SKLearn Pipelines<a class="headerlink" href="#a-wine-quality-prediction-experiment-with-sklearn-pipelines" title="Link to this heading">#</a></h1>
<p>In this experiment, let us use the <a class="reference external" href="https://www.kaggle.com/datasets/yasserh/wine-quality-dataset/data">Wine Quality Dataset from Kaggle</a> to predict the quality of wine based on its features. We will investigate the dataset, use <a class="reference external" href="https://scikit-learn.org/stable/">SKLearn</a> pipelines to preprocess the data, and to evaluate the performance of different models towards finding a suitable regressor. This is a normal activity in any machine learning project.</p>
<section id="loading-the-data">
<h2>Loading the data<a class="headerlink" href="#loading-the-data" title="Link to this heading">#</a></h2>
<p>Let us start by loading the data into a Pandas dataframe. Remember that a Dataframe is a 2-dimensional labeled data structure with columns of potentially different types. You can think of it like a spreadsheet or SQL table, or a dictionary of Series objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in &#39;.data/WineQT.csv&#39; as a pandas dataframe</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">wine</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;.data/WineQT.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us look at a few data examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fixed acidity</th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>residual sugar</th>
      <th>chlorides</th>
      <th>free sulfur dioxide</th>
      <th>total sulfur dioxide</th>
      <th>density</th>
      <th>pH</th>
      <th>sulphates</th>
      <th>alcohol</th>
      <th>quality</th>
      <th>Id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.4</td>
      <td>0.700</td>
      <td>0.00</td>
      <td>1.9</td>
      <td>0.076</td>
      <td>11.0</td>
      <td>34.0</td>
      <td>0.99780</td>
      <td>3.51</td>
      <td>0.56</td>
      <td>9.4</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7.8</td>
      <td>0.880</td>
      <td>0.00</td>
      <td>2.6</td>
      <td>0.098</td>
      <td>25.0</td>
      <td>67.0</td>
      <td>0.99680</td>
      <td>3.20</td>
      <td>0.68</td>
      <td>9.8</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.8</td>
      <td>0.760</td>
      <td>0.04</td>
      <td>2.3</td>
      <td>0.092</td>
      <td>15.0</td>
      <td>54.0</td>
      <td>0.99700</td>
      <td>3.26</td>
      <td>0.65</td>
      <td>9.8</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11.2</td>
      <td>0.280</td>
      <td>0.56</td>
      <td>1.9</td>
      <td>0.075</td>
      <td>17.0</td>
      <td>60.0</td>
      <td>0.99800</td>
      <td>3.16</td>
      <td>0.58</td>
      <td>9.8</td>
      <td>6</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7.4</td>
      <td>0.700</td>
      <td>0.00</td>
      <td>1.9</td>
      <td>0.076</td>
      <td>11.0</td>
      <td>34.0</td>
      <td>0.99780</td>
      <td>3.51</td>
      <td>0.56</td>
      <td>9.4</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1138</th>
      <td>6.3</td>
      <td>0.510</td>
      <td>0.13</td>
      <td>2.3</td>
      <td>0.076</td>
      <td>29.0</td>
      <td>40.0</td>
      <td>0.99574</td>
      <td>3.42</td>
      <td>0.75</td>
      <td>11.0</td>
      <td>6</td>
      <td>1592</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>6.8</td>
      <td>0.620</td>
      <td>0.08</td>
      <td>1.9</td>
      <td>0.068</td>
      <td>28.0</td>
      <td>38.0</td>
      <td>0.99651</td>
      <td>3.42</td>
      <td>0.82</td>
      <td>9.5</td>
      <td>6</td>
      <td>1593</td>
    </tr>
    <tr>
      <th>1140</th>
      <td>6.2</td>
      <td>0.600</td>
      <td>0.08</td>
      <td>2.0</td>
      <td>0.090</td>
      <td>32.0</td>
      <td>44.0</td>
      <td>0.99490</td>
      <td>3.45</td>
      <td>0.58</td>
      <td>10.5</td>
      <td>5</td>
      <td>1594</td>
    </tr>
    <tr>
      <th>1141</th>
      <td>5.9</td>
      <td>0.550</td>
      <td>0.10</td>
      <td>2.2</td>
      <td>0.062</td>
      <td>39.0</td>
      <td>51.0</td>
      <td>0.99512</td>
      <td>3.52</td>
      <td>0.76</td>
      <td>11.2</td>
      <td>6</td>
      <td>1595</td>
    </tr>
    <tr>
      <th>1142</th>
      <td>5.9</td>
      <td>0.645</td>
      <td>0.12</td>
      <td>2.0</td>
      <td>0.075</td>
      <td>32.0</td>
      <td>44.0</td>
      <td>0.99547</td>
      <td>3.57</td>
      <td>0.71</td>
      <td>10.2</td>
      <td>5</td>
      <td>1597</td>
    </tr>
  </tbody>
</table>
<p>1143 rows × 13 columns</p>
</div></div></div>
</div>
<p>We can see the dataset is composed of 1143 samples, with 13 columns in total. Let us check the various datatypes in the dataset, and ensure there are no missing values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1143 entries, 0 to 1142
Data columns (total 13 columns):
 #   Column                Non-Null Count  Dtype  
---  ------                --------------  -----  
 0   fixed acidity         1143 non-null   float64
 1   volatile acidity      1143 non-null   float64
 2   citric acid           1143 non-null   float64
 3   residual sugar        1143 non-null   float64
 4   chlorides             1143 non-null   float64
 5   free sulfur dioxide   1143 non-null   float64
 6   total sulfur dioxide  1143 non-null   float64
 7   density               1143 non-null   float64
 8   pH                    1143 non-null   float64
 9   sulphates             1143 non-null   float64
 10  alcohol               1143 non-null   float64
 11  quality               1143 non-null   int64  
 12  Id                    1143 non-null   int64  
dtypes: float64(11), int64(2)
memory usage: 116.2 KB
</pre></div>
</div>
</div>
</div>
<p>We don’t particularly care about the <code class="docutils literal notranslate"><span class="pre">Id</span></code> column, so let us drop it from the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us further describe the dataset to understand the distribution of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_37a6b_row0_col0 {
  background-color: #81ca81;
  color: #000000;
}
#T_37a6b_row0_col1 {
  background-color: #bde5b6;
  color: #000000;
}
#T_37a6b_row0_col2, #T_37a6b_row0_col9 {
  background-color: #c2e7bb;
  color: #000000;
}
#T_37a6b_row0_col3, #T_37a6b_row4_col4, #T_37a6b_row4_col6 {
  background-color: #e7f6e3;
  color: #000000;
}
#T_37a6b_row0_col4 {
  background-color: #e5f5e0;
  color: #000000;
}
#T_37a6b_row0_col5 {
  background-color: #cfecc9;
  color: #000000;
}
#T_37a6b_row0_col6 {
  background-color: #e1f3dc;
  color: #000000;
}
#T_37a6b_row0_col7, #T_37a6b_row4_col7, #T_37a6b_row5_col7 {
  background-color: #00451c;
  color: #f1f1f1;
}
#T_37a6b_row0_col8, #T_37a6b_row4_col8 {
  background-color: #107a37;
  color: #f1f1f1;
}
#T_37a6b_row0_col10 {
  background-color: #349d53;
  color: #f1f1f1;
}
#T_37a6b_row0_col11 {
  background-color: #359e53;
  color: #f1f1f1;
}
#T_37a6b_row1_col0, #T_37a6b_row1_col7, #T_37a6b_row1_col8, #T_37a6b_row1_col9, #T_37a6b_row1_col10, #T_37a6b_row1_col11, #T_37a6b_row2_col1, #T_37a6b_row2_col2, #T_37a6b_row2_col3, #T_37a6b_row2_col4, #T_37a6b_row2_col5, #T_37a6b_row2_col6 {
  background-color: #f7fcf5;
  color: #000000;
}
#T_37a6b_row1_col1 {
  background-color: #f1faee;
  color: #000000;
}
#T_37a6b_row1_col2 {
  background-color: #d4eece;
  color: #000000;
}
#T_37a6b_row1_col3 {
  background-color: #f3faf0;
  color: #000000;
}
#T_37a6b_row1_col4 {
  background-color: #eff9eb;
  color: #000000;
}
#T_37a6b_row1_col5 {
  background-color: #e2f4dd;
  color: #000000;
}
#T_37a6b_row1_col6, #T_37a6b_row3_col4 {
  background-color: #e9f7e5;
  color: #000000;
}
#T_37a6b_row2_col0 {
  background-color: #d3eecd;
  color: #000000;
}
#T_37a6b_row2_col7 {
  background-color: #00481d;
  color: #f1f1f1;
}
#T_37a6b_row2_col8 {
  background-color: #369f54;
  color: #f1f1f1;
}
#T_37a6b_row2_col9, #T_37a6b_row3_col5, #T_37a6b_row4_col3 {
  background-color: #ebf7e7;
  color: #000000;
}
#T_37a6b_row2_col10 {
  background-color: #68be70;
  color: #000000;
}
#T_37a6b_row2_col11, #T_37a6b_row5_col9 {
  background-color: #b6e2af;
  color: #000000;
}
#T_37a6b_row3_col0 {
  background-color: #a0d99b;
  color: #000000;
}
#T_37a6b_row3_col1 {
  background-color: #d7efd1;
  color: #000000;
}
#T_37a6b_row3_col2 {
  background-color: #eaf7e6;
  color: #000000;
}
#T_37a6b_row3_col3 {
  background-color: #edf8ea;
  color: #000000;
}
#T_37a6b_row3_col6 {
  background-color: #f0f9ec;
  color: #000000;
}
#T_37a6b_row3_col7 {
  background-color: #00471c;
  color: #f1f1f1;
}
#T_37a6b_row3_col8 {
  background-color: #17813d;
  color: #f1f1f1;
}
#T_37a6b_row3_col9 {
  background-color: #d1edcb;
  color: #000000;
}
#T_37a6b_row3_col10 {
  background-color: #48ae60;
  color: #f1f1f1;
}
#T_37a6b_row3_col11 {
  background-color: #52b365;
  color: #f1f1f1;
}
#T_37a6b_row4_col0 {
  background-color: #8bcf89;
  color: #000000;
}
#T_37a6b_row4_col1 {
  background-color: #c0e6b9;
  color: #000000;
}
#T_37a6b_row4_col2 {
  background-color: #c7e9c0;
  color: #000000;
}
#T_37a6b_row4_col5 {
  background-color: #d9f0d3;
  color: #000000;
}
#T_37a6b_row4_col9 {
  background-color: #c9eac2;
  color: #000000;
}
#T_37a6b_row4_col10 {
  background-color: #39a257;
  color: #f1f1f1;
}
#T_37a6b_row4_col11, #T_37a6b_row5_col11 {
  background-color: #2a924a;
  color: #f1f1f1;
}
#T_37a6b_row5_col0 {
  background-color: #6dc072;
  color: #000000;
}
#T_37a6b_row5_col1 {
  background-color: #a7dba0;
  color: #000000;
}
#T_37a6b_row5_col2 {
  background-color: #91d28e;
  color: #000000;
}
#T_37a6b_row5_col3 {
  background-color: #e7f6e2;
  color: #000000;
}
#T_37a6b_row5_col4 {
  background-color: #e4f5df;
  color: #000000;
}
#T_37a6b_row5_col5 {
  background-color: #b8e3b2;
  color: #000000;
}
#T_37a6b_row5_col6 {
  background-color: #d5efcf;
  color: #000000;
}
#T_37a6b_row5_col8 {
  background-color: #097532;
  color: #f1f1f1;
}
#T_37a6b_row5_col10 {
  background-color: #29914a;
  color: #f1f1f1;
}
#T_37a6b_row6_col0, #T_37a6b_row6_col1, #T_37a6b_row6_col2, #T_37a6b_row6_col3, #T_37a6b_row6_col4, #T_37a6b_row6_col5, #T_37a6b_row6_col6, #T_37a6b_row6_col7, #T_37a6b_row6_col8, #T_37a6b_row6_col9, #T_37a6b_row6_col10, #T_37a6b_row6_col11 {
  background-color: #00441b;
  color: #f1f1f1;
}
</style>
<table id="T_37a6b">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_37a6b_level0_col0" class="col_heading level0 col0" >fixed acidity</th>
      <th id="T_37a6b_level0_col1" class="col_heading level0 col1" >volatile acidity</th>
      <th id="T_37a6b_level0_col2" class="col_heading level0 col2" >citric acid</th>
      <th id="T_37a6b_level0_col3" class="col_heading level0 col3" >residual sugar</th>
      <th id="T_37a6b_level0_col4" class="col_heading level0 col4" >chlorides</th>
      <th id="T_37a6b_level0_col5" class="col_heading level0 col5" >free sulfur dioxide</th>
      <th id="T_37a6b_level0_col6" class="col_heading level0 col6" >total sulfur dioxide</th>
      <th id="T_37a6b_level0_col7" class="col_heading level0 col7" >density</th>
      <th id="T_37a6b_level0_col8" class="col_heading level0 col8" >pH</th>
      <th id="T_37a6b_level0_col9" class="col_heading level0 col9" >sulphates</th>
      <th id="T_37a6b_level0_col10" class="col_heading level0 col10" >alcohol</th>
      <th id="T_37a6b_level0_col11" class="col_heading level0 col11" >quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_37a6b_level0_row0" class="row_heading level0 row0" >mean</th>
      <td id="T_37a6b_row0_col0" class="data row0 col0" >8.311111</td>
      <td id="T_37a6b_row0_col1" class="data row0 col1" >0.531339</td>
      <td id="T_37a6b_row0_col2" class="data row0 col2" >0.268364</td>
      <td id="T_37a6b_row0_col3" class="data row0 col3" >2.532152</td>
      <td id="T_37a6b_row0_col4" class="data row0 col4" >0.086933</td>
      <td id="T_37a6b_row0_col5" class="data row0 col5" >15.615486</td>
      <td id="T_37a6b_row0_col6" class="data row0 col6" >45.914698</td>
      <td id="T_37a6b_row0_col7" class="data row0 col7" >0.996730</td>
      <td id="T_37a6b_row0_col8" class="data row0 col8" >3.311015</td>
      <td id="T_37a6b_row0_col9" class="data row0 col9" >0.657708</td>
      <td id="T_37a6b_row0_col10" class="data row0 col10" >10.442111</td>
      <td id="T_37a6b_row0_col11" class="data row0 col11" >5.657043</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row1" class="row_heading level0 row1" >std</th>
      <td id="T_37a6b_row1_col0" class="data row1 col0" >1.747595</td>
      <td id="T_37a6b_row1_col1" class="data row1 col1" >0.179633</td>
      <td id="T_37a6b_row1_col2" class="data row1 col2" >0.196686</td>
      <td id="T_37a6b_row1_col3" class="data row1 col3" >1.355917</td>
      <td id="T_37a6b_row1_col4" class="data row1 col4" >0.047267</td>
      <td id="T_37a6b_row1_col5" class="data row1 col5" >10.250486</td>
      <td id="T_37a6b_row1_col6" class="data row1 col6" >32.782130</td>
      <td id="T_37a6b_row1_col7" class="data row1 col7" >0.001925</td>
      <td id="T_37a6b_row1_col8" class="data row1 col8" >0.156664</td>
      <td id="T_37a6b_row1_col9" class="data row1 col9" >0.170399</td>
      <td id="T_37a6b_row1_col10" class="data row1 col10" >1.082196</td>
      <td id="T_37a6b_row1_col11" class="data row1 col11" >0.805824</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row2" class="row_heading level0 row2" >min</th>
      <td id="T_37a6b_row2_col0" class="data row2 col0" >4.600000</td>
      <td id="T_37a6b_row2_col1" class="data row2 col1" >0.120000</td>
      <td id="T_37a6b_row2_col2" class="data row2 col2" >0.000000</td>
      <td id="T_37a6b_row2_col3" class="data row2 col3" >0.900000</td>
      <td id="T_37a6b_row2_col4" class="data row2 col4" >0.012000</td>
      <td id="T_37a6b_row2_col5" class="data row2 col5" >1.000000</td>
      <td id="T_37a6b_row2_col6" class="data row2 col6" >6.000000</td>
      <td id="T_37a6b_row2_col7" class="data row2 col7" >0.990070</td>
      <td id="T_37a6b_row2_col8" class="data row2 col8" >2.740000</td>
      <td id="T_37a6b_row2_col9" class="data row2 col9" >0.330000</td>
      <td id="T_37a6b_row2_col10" class="data row2 col10" >8.400000</td>
      <td id="T_37a6b_row2_col11" class="data row2 col11" >3.000000</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row3" class="row_heading level0 row3" >25%</th>
      <td id="T_37a6b_row3_col0" class="data row3 col0" >7.100000</td>
      <td id="T_37a6b_row3_col1" class="data row3 col1" >0.392500</td>
      <td id="T_37a6b_row3_col2" class="data row3 col2" >0.090000</td>
      <td id="T_37a6b_row3_col3" class="data row3 col3" >1.900000</td>
      <td id="T_37a6b_row3_col4" class="data row3 col4" >0.070000</td>
      <td id="T_37a6b_row3_col5" class="data row3 col5" >7.000000</td>
      <td id="T_37a6b_row3_col6" class="data row3 col6" >21.000000</td>
      <td id="T_37a6b_row3_col7" class="data row3 col7" >0.995570</td>
      <td id="T_37a6b_row3_col8" class="data row3 col8" >3.205000</td>
      <td id="T_37a6b_row3_col9" class="data row3 col9" >0.550000</td>
      <td id="T_37a6b_row3_col10" class="data row3 col10" >9.500000</td>
      <td id="T_37a6b_row3_col11" class="data row3 col11" >5.000000</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row4" class="row_heading level0 row4" >50%</th>
      <td id="T_37a6b_row4_col0" class="data row4 col0" >7.900000</td>
      <td id="T_37a6b_row4_col1" class="data row4 col1" >0.520000</td>
      <td id="T_37a6b_row4_col2" class="data row4 col2" >0.250000</td>
      <td id="T_37a6b_row4_col3" class="data row4 col3" >2.200000</td>
      <td id="T_37a6b_row4_col4" class="data row4 col4" >0.079000</td>
      <td id="T_37a6b_row4_col5" class="data row4 col5" >13.000000</td>
      <td id="T_37a6b_row4_col6" class="data row4 col6" >37.000000</td>
      <td id="T_37a6b_row4_col7" class="data row4 col7" >0.996680</td>
      <td id="T_37a6b_row4_col8" class="data row4 col8" >3.310000</td>
      <td id="T_37a6b_row4_col9" class="data row4 col9" >0.620000</td>
      <td id="T_37a6b_row4_col10" class="data row4 col10" >10.200000</td>
      <td id="T_37a6b_row4_col11" class="data row4 col11" >6.000000</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row5" class="row_heading level0 row5" >75%</th>
      <td id="T_37a6b_row5_col0" class="data row5 col0" >9.100000</td>
      <td id="T_37a6b_row5_col1" class="data row5 col1" >0.640000</td>
      <td id="T_37a6b_row5_col2" class="data row5 col2" >0.420000</td>
      <td id="T_37a6b_row5_col3" class="data row5 col3" >2.600000</td>
      <td id="T_37a6b_row5_col4" class="data row5 col4" >0.090000</td>
      <td id="T_37a6b_row5_col5" class="data row5 col5" >21.000000</td>
      <td id="T_37a6b_row5_col6" class="data row5 col6" >61.000000</td>
      <td id="T_37a6b_row5_col7" class="data row5 col7" >0.997845</td>
      <td id="T_37a6b_row5_col8" class="data row5 col8" >3.400000</td>
      <td id="T_37a6b_row5_col9" class="data row5 col9" >0.730000</td>
      <td id="T_37a6b_row5_col10" class="data row5 col10" >11.100000</td>
      <td id="T_37a6b_row5_col11" class="data row5 col11" >6.000000</td>
    </tr>
    <tr>
      <th id="T_37a6b_level0_row6" class="row_heading level0 row6" >max</th>
      <td id="T_37a6b_row6_col0" class="data row6 col0" >15.900000</td>
      <td id="T_37a6b_row6_col1" class="data row6 col1" >1.580000</td>
      <td id="T_37a6b_row6_col2" class="data row6 col2" >1.000000</td>
      <td id="T_37a6b_row6_col3" class="data row6 col3" >15.500000</td>
      <td id="T_37a6b_row6_col4" class="data row6 col4" >0.611000</td>
      <td id="T_37a6b_row6_col5" class="data row6 col5" >68.000000</td>
      <td id="T_37a6b_row6_col6" class="data row6 col6" >289.000000</td>
      <td id="T_37a6b_row6_col7" class="data row6 col7" >1.003690</td>
      <td id="T_37a6b_row6_col8" class="data row6 col8" >4.010000</td>
      <td id="T_37a6b_row6_col9" class="data row6 col9" >2.000000</td>
      <td id="T_37a6b_row6_col10" class="data row6 col10" >14.900000</td>
      <td id="T_37a6b_row6_col11" class="data row6 col11" >8.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>And let’s visually inspect the distribution of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Assuming df is your DataFrame</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">wine</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Greens&quot;</span><span class="p">)</span>  <span class="c1"># This applies the green palette directly</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>  <span class="c1"># Rotate x-tick labels for better readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5de37166d765c2186914b15ea95a90bc44e241b489eb514bc92c3bb6ed6244e4.png" src="../_images/5de37166d765c2186914b15ea95a90bc44e241b489eb514bc92c3bb6ed6244e4.png" />
</div>
</div>
<p>Notice above how ‘total sulfur dioxide’ and ‘free sulfur dioxide’ have a very different scale compared to the other features.</p>
<div class="alert alert-block alert-info">
<b>Note: </b>
An important step in preprocessing the data is to scale the features. This is because the features are in different scales, and this can affect the performance of the model. We will use a MinMaxScaler() to scale the features when defining the pipeline for our processing, as MinMaxScaler() scales the data to a fixed range [0, 1] and helps in preserving the shape of the original distribution (while being more sensitive to outliers).
</div>
<p>Our target variable is the ‘quality’ column, let us look at its distribution more carefully.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the distribution of &#39;quality&#39;</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">wine</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
    </tr>
    <tr>
      <th>quality</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>483</td>
    </tr>
    <tr>
      <th>6</th>
      <td>462</td>
    </tr>
    <tr>
      <th>7</th>
      <td>143</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
    </tr>
    <tr>
      <th>8</th>
      <td>16</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can see the majority of wines have a quality of 5 or 6, with only very few wines having a quality of 3 or 4. Let us see this as a histogram of the quality column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the distribution of &#39;quality&#39; as a histogram using Seaborne.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">wine</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Quality&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Quality&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a50f18bbfc079c7bac641e3d41292690468f506582195e2ac842358ec97c9b83.png" src="../_images/a50f18bbfc079c7bac641e3d41292690468f506582195e2ac842358ec97c9b83.png" />
</div>
</div>
<p>Let us now look at the correlation of the features with the target variable. Let us also drop all columns with a correlation of less than 0.2 with the target variable - this will help us reduce the number of features in our model, and help the model generalize better by focusing on the most important features.</p>
<div class="alert alert-block alert-info">
<b>Note: </b>
In many cases, it is important to reduce the number of features in the model. This is because having too many features can lead to overfitting, and the model may not generalize well to new data. In this case, we are dropping features with a correlation of less than 0.2 with the target variable, as they are less likely to be important in predicting the quality of wine.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot a correlation chart of the features against the &#39;quality&#39; target variable.</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Calculate the correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Identify features with correlation to &#39;quality&#39; less than 0.2</span>
<span class="c1"># Use absolute value to consider both positive and negative correlations</span>
<span class="n">features_to_keep</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;summer_r&#39;</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Wine Chemistry/Quality Correlation Heatmap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Keep these features in the DataFrame, including the target variable &#39;quality&#39;</span>
<span class="n">wine</span> <span class="o">=</span> <span class="n">wine</span><span class="p">[</span><span class="n">features_to_keep</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/478bad7e73565f681da929de1a5c019f9816f08b1b6b8cd142770f223388d69d.png" src="../_images/478bad7e73565f681da929de1a5c019f9816f08b1b6b8cd142770f223388d69d.png" />
</div>
</div>
<p>From this correlation matrix it becomes apparent that <code class="docutils literal notranslate"><span class="pre">alcohol</span></code>, <code class="docutils literal notranslate"><span class="pre">sulphates</span></code>, <code class="docutils literal notranslate"><span class="pre">volatile</span> <span class="pre">acidity</span></code> and <code class="docutils literal notranslate"><span class="pre">citric</span> <span class="pre">acid</span></code> are the features with the highest correlation with the target variable.</p>
<p>Now let us plot a matrix for the features to see how they are related to each other. This will help us understand the multicollinearity between the features, as effectively a chemical feature comparison. Notice how we now have a smaller number of features, as we dropped the ones with a correlation of less than 0.2 with the target variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let us chart a matrix of plots, with X vs Y between all features.</span>
<span class="c1"># This will effectively give us a chemical composition matrix, where the color of the plot will indicate the quality.</span>

<span class="c1"># Pair plot using seaborn</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s2">&quot;paper&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>  <span class="c1"># Set the style of the visualization</span>
<span class="n">pairplot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">wine</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span> <span class="n">corner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pairplot</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Wine chemical features by Quality&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">wine</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ef8ecca4782efc2b89e1788de3e34c450dc11d1319a4b8ac75dcceeef34ea990.png" src="../_images/ef8ecca4782efc2b89e1788de3e34c450dc11d1319a4b8ac75dcceeef34ea990.png" />
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>volatile acidity</th>
      <th>citric acid</th>
      <th>sulphates</th>
      <th>alcohol</th>
      <th>quality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.700</td>
      <td>0.00</td>
      <td>0.56</td>
      <td>9.4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.880</td>
      <td>0.00</td>
      <td>0.68</td>
      <td>9.8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.760</td>
      <td>0.04</td>
      <td>0.65</td>
      <td>9.8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.280</td>
      <td>0.56</td>
      <td>0.58</td>
      <td>9.8</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.700</td>
      <td>0.00</td>
      <td>0.56</td>
      <td>9.4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1138</th>
      <td>0.510</td>
      <td>0.13</td>
      <td>0.75</td>
      <td>11.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>0.620</td>
      <td>0.08</td>
      <td>0.82</td>
      <td>9.5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1140</th>
      <td>0.600</td>
      <td>0.08</td>
      <td>0.58</td>
      <td>10.5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1141</th>
      <td>0.550</td>
      <td>0.10</td>
      <td>0.76</td>
      <td>11.2</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1142</th>
      <td>0.645</td>
      <td>0.12</td>
      <td>0.71</td>
      <td>10.2</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>1143 rows × 5 columns</p>
</div></div></div>
</div>
<p>Now let us derive a second dataset, grouped by quality, where each featured is averaged. We will then use this to plot an aggregate positioning of the best correlated features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wine_grouped_by_quality</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;quality&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">wine_grouped_by_quality</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And now let us plot the positioning for the three best correlators.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Adjusting figure size</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="c1"># Normalize &#39;quality&#39; values for color mapping</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Greens&#39;</span><span class="p">)(</span><span class="n">norm</span><span class="p">(</span><span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]))</span>

<span class="c1"># 3D scatter plot</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">],</span> 
                <span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;sulphates&#39;</span><span class="p">],</span> 
                <span class="n">wine_grouped_by_quality</span><span class="p">[</span><span class="s1">&#39;citric acid&#39;</span><span class="p">],</span> 
                <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create a color bar with the correct mapping</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Quality&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># Set font size for the color bar tick labels</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Adjust labelsize as needed</span>

<span class="c1"># Labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alcohol&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Sulphates&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Citric Acid&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Highest Positive Correlator Positions&#39;</span><span class="p">)</span>

<span class="c1"># Set font size for the tick labels on all axes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b6838b94434c0ef3c98d66d6f8d49df30ec401213d6a7afe5ed80b9fc5502d1f.png" src="../_images/b6838b94434c0ef3c98d66d6f8d49df30ec401213d6a7afe5ed80b9fc5502d1f.png" />
</div>
</div>
</section>
<section id="evaluating-different-models">
<h2>Evaluating different models<a class="headerlink" href="#evaluating-different-models" title="Link to this heading">#</a></h2>
<p>Let us now evaluate different models to predict the quality of the wine. We will use a pipeline to preprocess the data, and then evaluate the performance of different models. We will use the following models:</p>
<ul class="simple">
<li><p><strong>Linear Regression</strong>: A simple echnique for regression that assumes a linear relationship between the input variables (features) and the single output variable (quality). It is often used as a baseline for regression tasks.</p></li>
<li><p><strong>Random Forest Regressor</strong>: An ensemble method that operates by constructing multiple decision trees during training time and outputting the average prediction of the individual trees. It is robust against overfitting and is often effective for a wide range of regression tasks.</p></li>
<li><p><strong>SVR (Support Vector Regression)</strong>: An extension of Support Vector Machines (SVM) to regression problems. SVR can efficiently perform linear and non-linear regression, capturing complex relationships between the features and the target variable.</p></li>
<li><p><strong>XGBoost Regressor</strong>: A highly efficient and scalable implementation of gradient boosting framework. XGBoost is known for its speed and performance, and it has become a popular choice in data science competitions for its ability to handle sparse data and its efficiency in training.</p></li>
<li><p><strong>KNeighbors Regressor</strong>: A type of instance-based learning or non-generalizing learning that does not attempt to construct a general internal model, but stores instances of the training data. Classification is computed from a simple majority vote of the nearest neighbors of each point.</p></li>
</ul>
<p>For each model, we will scale the features using <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> to ensure that all features contribute equally to the result. This is particularly important for models like SVR and KNeighbors Regressor, which are sensitive to the scale of the input features. We will then perform hyperparameter tuning to find the best parameters for each model, using <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> to systematically explore a range of parameters for each model. Finally, we will evaluate the performance of each model based on the negative mean squared error (<code class="docutils literal notranslate"><span class="pre">neg_mean_squared_error</span></code>), allowing us to identify the model that best predicts the quality of the wine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Split &#39;wine&#39; into features (X, all columns except quality) and target (y, only quality)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">wine</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">wine</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>

<span class="c1"># Split the dataset into training and testing sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Define models and their respective parameter grids. Note that the parameter grid keys must be prefixed by the model name in the pipeline.</span>
<span class="n">models_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Linear Regression&#39;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">(),</span> <span class="p">{}),</span>
    <span class="p">(</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(),</span> <span class="p">{</span>
        <span class="s1">&#39;Random Forest__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
        <span class="s1">&#39;Random Forest__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;SVR&#39;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">(),</span> <span class="p">{</span>
        <span class="s1">&#39;SVR__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
        <span class="s1">&#39;SVR__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;XGBoost&#39;</span><span class="p">,</span> <span class="n">XGBRegressor</span><span class="p">(),</span> <span class="p">{</span>
        <span class="s1">&#39;XGBoost__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">800</span><span class="p">],</span>
        <span class="s1">&#39;XGBoost__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="s1">&#39;XGBoost__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
        <span class="s1">&#39;XGBoost__seed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">42</span><span class="p">],</span>
    <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;KNeighbors&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">(),</span> <span class="p">{</span>
        <span class="s1">&#39;KNeighbors__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
        <span class="s1">&#39;KNeighbors__weights&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">],</span>
    <span class="p">})</span>
<span class="p">]</span>

<span class="n">best_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
<span class="n">best_regressor</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">regressor</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">models_params</span><span class="p">:</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>  <span class="c1"># Scale features</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">regressor</span><span class="p">)</span>  <span class="c1"># Use the model name as the step name in the pipeline</span>
    <span class="p">])</span>
    
    <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
        <span class="c1"># Perform hyperparameter tuning for models with a defined parameter grid</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># For simplicity, directly evaluate models without a parameter grid</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">))</span>
    
    <span class="c1"># Store the model name and score</span>
    <span class="n">model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="n">best_regressor</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">best_params</span> <span class="o">=</span> <span class="n">params</span>

<span class="c1"># Calculate MSE by negating the best_score</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">best_score</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best regressor: </span><span class="si">{</span><span class="n">best_regressor</span><span class="si">}</span><span class="s2"> with neg_mean_squared_error score: </span><span class="si">{</span><span class="n">best_score</span><span class="si">}</span><span class="s2">, MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">, and parameters: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Pair each model name with its score, sort by score, and then unzip back into separate lists</span>
<span class="n">sorted_pairs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">model_names</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Unzipping the sorted pairs</span>
<span class="n">sorted_scores</span><span class="p">,</span> <span class="n">sorted_model_names</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_pairs</span><span class="p">)</span>

<span class="c1"># Plotting the performance of each model with sorted values</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">sorted_model_names</span><span class="p">,</span> <span class="p">[</span><span class="n">score</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">sorted_scores</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2CA02C&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error (MSE)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model Performance (smaller is better)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best regressor: KNeighbors with neg_mean_squared_error score: -0.38768439914783254, MSE: 0.38768439914783254, and parameters: {&#39;KNeighbors__n_neighbors&#39;: 9, &#39;KNeighbors__weights&#39;: &#39;distance&#39;}
</pre></div>
</div>
<img alt="../_images/36e5e90731c54637942411214e2d3cda6d6f16136cc1f261e7ac1dbb11631a24.png" src="../_images/36e5e90731c54637942411214e2d3cda6d6f16136cc1f261e7ac1dbb11631a24.png" />
</div>
</div>
<p>That’s great! We now know the best performing model!</p>
<p>Now let us run some actual predictions with the best performing model, and plot residuals.</p>
<div class="alert alert-block alert-info">
<b>Note: </b>
Residuals are the difference between the observed values and the predicted values. By plotting the residuals, we can visually inspect the performance of the model. Ideally, the residuals should be randomly distributed around zero, indicating that the model is making predictions without any systematic errors. If we observe a pattern in the residuals, it may indicate that the model is not capturing some underlying patterns in the data.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1"># Since you&#39;re using named steps in the pipeline, update `best_params` to work with `set_params`</span>
<span class="n">best_params_updated</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">best_regressor</span><span class="si">}</span><span class="s1">__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">best_params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1"># Recreate the best pipeline with the best parameters</span>
<span class="k">if</span> <span class="n">best_regressor</span> <span class="o">==</span> <span class="s1">&#39;Linear Regression&#39;</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_updated</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">best_regressor</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_updated</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">best_regressor</span> <span class="o">==</span> <span class="s1">&#39;SVR&#39;</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_updated</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">best_regressor</span> <span class="o">==</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_updated</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">best_regressor</span> <span class="o">==</span> <span class="s1">&#39;KNeighbors&#39;</span><span class="p">:</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">best_params_updated</span><span class="p">)</span>

<span class="c1"># Initialize the pipeline with the best model</span>
<span class="n">best_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="n">best_regressor</span><span class="p">,</span> <span class="n">best_model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Retrain on the full training set</span>
<span class="n">best_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Predict on the test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

<span class="c1"># Calculate and print the MSE on the test set for evaluation</span>
<span class="n">test_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test MSE for the best regressor (</span><span class="si">{</span><span class="n">best_regressor</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">test_mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print summary statistics of the residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Residuals Summary Statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Residual plot using seaborn and matplotlib</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Set the figure size</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2CA02C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>  <span class="c1"># Adding a horizontal line at 0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residual Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Actual Values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Histogram of residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># Set the figure size</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2CA02C&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test MSE for the best regressor (KNeighbors): 0.3381499055639954
Residuals Summary Statistics:
count    229.000000
mean      -0.048154
std        0.580779
min       -2.233049
25%       -0.351151
50%        0.000000
75%        0.241689
max        1.923910
Name: quality, dtype: float64
</pre></div>
</div>
<img alt="../_images/8e27faf1d3f7fd9043c2dac69c5c403cfeb4dcfff185f4a34e031c2dde07250d.png" src="../_images/8e27faf1d3f7fd9043c2dac69c5c403cfeb4dcfff185f4a34e031c2dde07250d.png" />
<img alt="../_images/1137471a2b416a56e0c5b6bba810c7def397b932a5f0c8640cdaa754d38e5e68.png" src="../_images/1137471a2b416a56e0c5b6bba810c7def397b932a5f0c8640cdaa754d38e5e68.png" />
</div>
</div>
</section>
<section id="final-remarks">
<h2>Final remarks<a class="headerlink" href="#final-remarks" title="Link to this heading">#</a></h2>
<p>In this experiment, we have explored the Wine Quality Dataset from Kaggle, preprocessed the data, and evaluated different models to predict the quality of wine. We have used a pipeline to preprocess the data, and evaluated the performance of different models using hyperparameter tuning and cross-validation. We have identified the best performing model based on the negative mean squared error, and used it to make predictions on the test set. Finally, we have plotted the residuals to visually inspect the performance of the model.</p>
<p>This is a typical workflow in a machine learning project, where we preprocess the data, evaluate different models, and select the best performing model for making predictions. We have used a variety of models in this experiment, including Linear Regression, Random Forest Regressor, SVR, XGBoost Regressor, and KNeighbors Regressor. Each of these models has its strengths and weaknesses, and it is important to evaluate their performance on the specific dataset to identify the best model for the task at hand.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./experiments"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="instance_vs_model_learning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Instance vs Model Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="sentiment-partI.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Sentiment Classification of Financial Texts using Neural Networks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">Loading the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-different-models">Evaluating different models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-remarks">Final remarks</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Pedro Leitao
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"></a>
    All content on this site (unless otherwise specified) is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>